)copy dfns alpush alget alset
⎕IO←0
mk ← 0×⍳6
n← 61554 60761 64559 62304 63021 63794 66389 69331 68416 68874 69044 69584 69593 68087 64629 64527 65102 66009 67483 68845 69060 68238 67504 69573 65298 60779 62223 62369 61645 59736 60803 59644 63133 64262 64523 65837 63614 62777 63321 62414 62766 61791 59182 56537 56904 58816 62592 62904 62723 62268 60888 60621 60207 60480 60610 60738 61134 61316 64637 65116

m←¯1× 2-/n

s1←⍬
s← {
 m≡⍬ : ⍬
 s1≡ ⍬ : { 1↑m >0 : 'u0' ⋄ 'd0'} 0
 ¯1↑s≡ 'u0': { 1↑m < -6 : 'd1'⋄ 'u0' } 0
 ¯1↑s≡ 'd0': { 1↑m > 6 : 'u1'⋄ 'd0' } 0
 ¯1↑s≡ 'd1': {1↑m > 6 :'u1,u0" ⋄mkd1<n[i]: 'd0' ⋄'d1'  } 0
 ¯1↑s≡ 'u1': {1↑m < -6 :'d1,d0"⋄mku1>n[i]: 'u0' ⋄'d1'  } 0

 ¯1↑s≡ 'd2': {1↑m > 6 :'u1,u0" ⋄ n[1]<mkd1:'d1' ⋄ 'd2  } 0
 ¯1↑s≡ 'u2': {1↑m < -6 :'u1,u0" ⋄ n[1]>mkd1:'d1' ⋄ 'd2  } 0
si ∇ m
}

step ← 300
u6←step
d6←step×-1
u3←step×÷2
d3←step×-÷2

0 1 2 3 4 5

⍝todo mvove mk to a

ps←{
   a b c ← ⍵
   a≡⍬: {b > 0: 1 ⋄ 4 } 0
   a=2:{b < d6: 2 ⋄ mk[2]← n[c]⋄ 4}
   a=3:{b > u6: 2 ⋄ mk[3]← n[c]⋄ 1}
   a=1:{ b < d6: {mk[1] ←n[c] ⋄n[c] > m[2]: 4 ⋄ 5 }: ⋄ n[c] > m[2]:  2⊢mk[1]←n[c] ⋄ 1  }  
   a=4:{ b >u6: {mk[4] ←n[c] ⋄n[c] > m[2]: 2 ⋄ 1 }: ⋄ n[c] < m[3]:  3⊢mk[4]←n[c] ⋄ 4  }  
   a=0: {b > mk[1] : 1⊢mk[0]←n[c] ⋄ 0 }
   a=5: {b < mk[4] : 4⊢mk[4]←n[c] ⋄ 5 }
}


s← {
    ⍵≡⍬: ⍺
    nv←ps ⍺ ⊃⍵ ((≡n)-(≡⍵)+1)
    (⍺,nv)∇1↓⍵
}

n ← 1 

sm ← { 
    ⍵≡⍬:⍺⋄ (⍺,(2×⊃⍵))∇1↓⍵ 
}
